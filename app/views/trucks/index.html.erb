<div class="page-header">
  <h1>Listing All Trucks</h1>
</div>

<table class='table table-responsive'>
  <thead>
    <tr>
      <th>Image</th>
      <th>Name</th>
      <th>Cuisine</th>
      <th>Menu</th>
      <th>Rating</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @trucks.each do |truck| %>
      <tr>
        <td><%= link_to image_tag(truck.image.url(:small)), truck %></td>
        <td><%= link_to truck.name, truck %></td>
        <td><%= truck.cuisine %></td>
        <td><%= truck.menu %></td>

        <td><% @reviews = Review.where(truck_id: truck.id) %>
          <% if @reviews.blank? %>
          <% @avg_review = 0 %>
          <% else %>
          <% @avg_review = @reviews.average(:rating).round(2) %>
          <% end %>
          <div class="star-rating" data-score= <%= @avg_review %> ></div>
        </td>


        <td><%= link_to 'View Truck', truck, class:'btn btn-primary' %></td>


        <% if truck.owner == current_owner %>
          <td><%= link_to 'Edit Truck Info', edit_truck_path(truck), class:'btn btn-primary' %></td>
          <td><%= link_to 'Remove Truck', truck, method: :delete, data: { confirm: 'Are you sure?' }, class:'btn btn-danger' %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>



<% if !current_owner.nil? %>
  <%= link_to ' Create a New Truck', new_truck_path, class:'btn btn-primary' %>
<% end %>

<script>
    $('.star-rating').raty({
      path: '/assets/',
      readOnly: true,
      score: function() {
            return $(this).attr('data-score');
    }
  });
</script>

<script>
  $('#star-rating').raty({
    path: '/assets/',
    scoreName: 'review[rating]'
  });
</script>
